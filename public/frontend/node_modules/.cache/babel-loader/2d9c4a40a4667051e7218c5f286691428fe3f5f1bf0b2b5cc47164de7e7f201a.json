{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.shouldUpdateDrawnRows = shouldUpdateDrawnRows;\nexports.setCurrentPosition = setCurrentPosition;\nexports.updatePositionProperties = updatePositionProperties;\nexports.updateRenderedData = updateRenderedData;\nvar _immutable = require('immutable');\nvar _immutable2 = _interopRequireDefault(_immutable);\nvar _initialState = require('./initial-state');\nvar _initialState2 = _interopRequireDefault(_initialState);\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction shouldUpdateDrawnRows(action, state) {\n  var height = state.getIn(['currentPosition', 'height']);\n  var width = state.getIn(['currentPosition', 'width']);\n\n  // If the containers have changed size, update drawn rows.\n  if (height != action.yVisible || width != action.xVisible) return true;\n  var yScrollChangePosition = state.getIn(['currentPosition', 'yScrollChangePosition']);\n  var rowHeight = state.getIn(['positionConfig', 'rowHeight']);\n\n  // Get the current visible record count.\n  var visibleRecordCount = getVisibleRecordCount(state);\n\n  // Get the count of rendered rows.\n  var startDisplayIndex = state.getIn(['currentPosition', 'renderedStartDisplayIndex']);\n  var endDisplayIndex = state.getIn(['currentPosition', 'renderedEndDisplayIndex']);\n  var renderedRecordCount = endDisplayIndex - startDisplayIndex;\n\n  // Calculate the height of a third of the difference.\n  var rowDifferenceHeight = rowHeight * (renderedRecordCount - visibleRecordCount) / 3;\n  return Math.abs(action.yScrollPosition - yScrollChangePosition) >= rowDifferenceHeight;\n}\nfunction setCurrentPosition(state, yScrollPosition, xScrollPosition) {\n  return state.setIn(['currentPosition', 'yScrollChangePosition'], yScrollPosition).setIn(['currentPosition', 'xScrollChangePosition'], xScrollPosition);\n}\nfunction updatePositionProperties(action, state, force) {\n  if (!action.force && !shouldUpdateDrawnRows(action, state) && !_immutable2.default.is(state.get('currentPosition'), (0, _initialState2.default)().get('currentPosition'))) {\n    return state; // Indicate that this shouldn't result in an emit.\n  }\n\n  var sizeUpdatedState = state.setIn(['currentPosition', 'height'], action.yVisible ? action.yVisible * 1.2 : state.getIn(['currentPosition', 'height'])).setIn(['currentPosition', 'width'], action.xVisible || state.getIn(['currentPosition', 'width']));\n  var visibleRecordCount = getVisibleRecordCount(sizeUpdatedState);\n  var visibleDataLength = helpers.getDataSetSize(sizeUpdatedState);\n  var rowHeight = sizeUpdatedState.getIn(['positionConfig', 'rowHeight']);\n  var verticalScrollPosition = action.yScrollPosition || 0;\n  var horizontalScrollPosition = action.xScrollPosition || 0;\n\n  // Inspired by : http://jsfiddle.net/vjeux/KbWJ2/9/\n  var renderedStartDisplayIndex = Math.max(0, Math.floor(Math.floor(verticalScrollPosition / rowHeight) - visibleRecordCount * 0.25));\n  var renderedEndDisplayIndex = Math.min(Math.floor(renderedStartDisplayIndex + visibleRecordCount * 2), visibleDataLength - 1) + 1;\n  return setCurrentPosition(sizeUpdatedState, verticalScrollPosition, horizontalScrollPosition).setIn(['currentPosition', 'renderedStartDisplayIndex'], renderedStartDisplayIndex).setIn(['currentPosition', 'renderedEndDisplayIndex'], renderedEndDisplayIndex).setIn(['currentPosition', 'visibleDataLength'], visibleDataLength);\n}\nfunction updateRenderedData(state) {\n  var startDisplayIndex = state.getIn(['currentPosition', 'renderedStartDisplayIndex']);\n  var columns = helpers.getDataColumns(state, data);\n  var data = helpers.getDataSet(state);\n  return state.set('renderedData', helpers.getVisibleDataColumns(data.skip(startDisplayIndex).take(state.getIn(['currentPosition', 'renderedEndDisplayIndex']) - startDisplayIndex), columns));\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","shouldUpdateDrawnRows","setCurrentPosition","updatePositionProperties","updateRenderedData","_immutable","require","_immutable2","_interopRequireDefault","_initialState","_initialState2","obj","__esModule","default","action","state","height","getIn","width","yVisible","xVisible","yScrollChangePosition","rowHeight","visibleRecordCount","getVisibleRecordCount","startDisplayIndex","endDisplayIndex","renderedRecordCount","rowDifferenceHeight","Math","abs","yScrollPosition","xScrollPosition","setIn","force","is","get","sizeUpdatedState","visibleDataLength","helpers","getDataSetSize","verticalScrollPosition","horizontalScrollPosition","renderedStartDisplayIndex","max","floor","renderedEndDisplayIndex","min","columns","getDataColumns","data","getDataSet","set","getVisibleDataColumns","skip","take"],"sources":["/Users/eugo/commentsold/lumen/public/front/node_modules/griddle-react/dist/module/plugins/position/utils.js"],"sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.shouldUpdateDrawnRows = shouldUpdateDrawnRows;\nexports.setCurrentPosition = setCurrentPosition;\nexports.updatePositionProperties = updatePositionProperties;\nexports.updateRenderedData = updateRenderedData;\n\nvar _immutable = require('immutable');\n\nvar _immutable2 = _interopRequireDefault(_immutable);\n\nvar _initialState = require('./initial-state');\n\nvar _initialState2 = _interopRequireDefault(_initialState);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction shouldUpdateDrawnRows(action, state) {\n  var height = state.getIn(['currentPosition', 'height']);\n  var width = state.getIn(['currentPosition', 'width']);\n\n  // If the containers have changed size, update drawn rows.\n  if (height != action.yVisible || width != action.xVisible) return true;\n\n  var yScrollChangePosition = state.getIn(['currentPosition', 'yScrollChangePosition']);\n  var rowHeight = state.getIn(['positionConfig', 'rowHeight']);\n\n  // Get the current visible record count.\n  var visibleRecordCount = getVisibleRecordCount(state);\n\n  // Get the count of rendered rows.\n  var startDisplayIndex = state.getIn(['currentPosition', 'renderedStartDisplayIndex']);\n  var endDisplayIndex = state.getIn(['currentPosition', 'renderedEndDisplayIndex']);\n  var renderedRecordCount = endDisplayIndex - startDisplayIndex;\n\n  // Calculate the height of a third of the difference.\n  var rowDifferenceHeight = rowHeight * (renderedRecordCount - visibleRecordCount) / 3;\n\n  return Math.abs(action.yScrollPosition - yScrollChangePosition) >= rowDifferenceHeight;\n}\n\nfunction setCurrentPosition(state, yScrollPosition, xScrollPosition) {\n  return state.setIn(['currentPosition', 'yScrollChangePosition'], yScrollPosition).setIn(['currentPosition', 'xScrollChangePosition'], xScrollPosition);\n}\n\nfunction updatePositionProperties(action, state, force) {\n  if (!action.force && !shouldUpdateDrawnRows(action, state) && !_immutable2.default.is(state.get('currentPosition'), (0, _initialState2.default)().get('currentPosition'))) {\n    return state; // Indicate that this shouldn't result in an emit.\n  }\n\n  var sizeUpdatedState = state.setIn(['currentPosition', 'height'], action.yVisible ? action.yVisible * 1.2 : state.getIn(['currentPosition', 'height'])).setIn(['currentPosition', 'width'], action.xVisible || state.getIn(['currentPosition', 'width']));\n\n  var visibleRecordCount = getVisibleRecordCount(sizeUpdatedState);\n  var visibleDataLength = helpers.getDataSetSize(sizeUpdatedState);\n\n  var rowHeight = sizeUpdatedState.getIn(['positionConfig', 'rowHeight']);\n\n  var verticalScrollPosition = action.yScrollPosition || 0;\n  var horizontalScrollPosition = action.xScrollPosition || 0;\n\n  // Inspired by : http://jsfiddle.net/vjeux/KbWJ2/9/\n  var renderedStartDisplayIndex = Math.max(0, Math.floor(Math.floor(verticalScrollPosition / rowHeight) - visibleRecordCount * 0.25));\n  var renderedEndDisplayIndex = Math.min(Math.floor(renderedStartDisplayIndex + visibleRecordCount * 2), visibleDataLength - 1) + 1;\n\n  return setCurrentPosition(sizeUpdatedState, verticalScrollPosition, horizontalScrollPosition).setIn(['currentPosition', 'renderedStartDisplayIndex'], renderedStartDisplayIndex).setIn(['currentPosition', 'renderedEndDisplayIndex'], renderedEndDisplayIndex).setIn(['currentPosition', 'visibleDataLength'], visibleDataLength);\n}\n\nfunction updateRenderedData(state) {\n  var startDisplayIndex = state.getIn(['currentPosition', 'renderedStartDisplayIndex']);\n  var columns = helpers.getDataColumns(state, data);\n  var data = helpers.getDataSet(state);\n\n  return state.set('renderedData', helpers.getVisibleDataColumns(data.skip(startDisplayIndex).take(state.getIn(['currentPosition', 'renderedEndDisplayIndex']) - startDisplayIndex), columns));\n}"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}